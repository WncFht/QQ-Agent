# LinkManager 插件

## 简介

LinkManager是一个协作式的链接管理系统，允许多个用户共同维护和丰富链接资源。每个链接可以有多个用户的描述，并且支持标签系统进行分类。系统实现了严格的群组隔离，确保每个群只能访问其自己的链接资源。

## 基本概念

1. **链接**：每个链接都有一个创建者，创建时间，以及可选的标签和描述。同时包含链接状态信息，包括有效性检查结果和最后检查时间。
2. **描述**：每个用户可以为链接添加一个描述，描述包含内容、作者和时间戳。
3. **标签**：链接可以有多个标签，所有用户都可以为链接添加新标签。
4. **群组隔离**：每个链接都属于特定的群组，只能在该群组内访问和管理。
5. **链接状态**：系统会定期检查链接的有效性，并在链接失效时通知创建者。
6. **权限**：
   - 所有用户都可以添加新链接
   - 用户只能编辑/更新自己的描述
   - 所有用户都可以为任何链接添加标签
   - 所有用户都可以查看本群内任何链接的完整信息
   - 链接仅在其所属群组内可见

## 命令列表

### 1. 添加或更新链接 (/add)

支持以下功能：

1. 基本添加链接：
```
/add <链接URL>
```

2. 添加链接和描述：
```
/add <链接URL> -d "这是一个描述"
```

3. 添加链接、描述和标签：
```
/add <链接URL> -d "这是一个描述" -t "标签1,标签2,标签3"
```

4. 追加新的描述（作为新用户）：
```
/add <链接URL> -d "新的描述" -a
```

5. 更新自己的描述：
```
/add <链接URL> -d "更新的描述" -u
```

参数说明：
- `-d` 或 `--desc`: 添加描述
- `-t` 或 `--tags`: 添加标签（用逗号分隔）
- `-a` 或 `--append`: 作为新用户添加描述
- `-u` 或 `--update`: 更新自己的已有描述

### 2. 查看链接详情 (/view)

查看链接的完整信息：
```
/view <链接URL>
```

### 3. 搜索链接 (/search)

支持以下功能：

1. 基本关键词搜索：
```
/search <关键词>
```

2. 按标签搜索：
```
/search <关键词> -t <标签>
```

### 4. 检查链接有效性 (/check_links)

手动触发链接有效性检查：
```
/check_links
```

### 5. 其他命令

- `/help` - 查看所有可用指令
- `网站` - 获取技术分享网站链接
- `公告` - 查看群公告

## 数据结构

链接在JSON文件中的存储格式：
```json
{
    "url": "https://example.com",
    "group_id": "1234567890",
    "creator_id": "2130212584",
    "creator_name": "创建者",
    "created_at": "2024-03-11 23:00:04",
    "last_checked": "2024-03-11 23:30:00",
    "is_valid": true,
    "status_message": "HTTP状态码: 200",
    "invalid_since": null,
    "tags": ["技术", "教程", "Python"],
    "descriptions": [
        {
            "content": "这是第一个描述",
            "user_id": "2130212584",
            "username": "用户1",
            "timestamp": "2024-03-11 23:00:04"
        },
        {
            "content": "这是另一个用户的描述",
            "user_id": "3456789012",
            "username": "用户2",
            "timestamp": "2024-03-11 23:05:04"
        }
    ]
}
```

## 链接有效性检查

系统会自动进行以下操作：

1. **定期检查**：每隔一小时自动检查所有链接的可访问性。
2. **状态更新**：
   - 记录最后检查时间
   - 更新链接状态（有效/无效）
   - 记录状态信息（HTTP状态码或错误信息）
   - 记录失效时间（如果链接失效）
3. **失效通知**：当链接失效时，系统会自动通过私信通知链接创建者。

## 欢迎功能

当新用户进群时，机器人会发送欢迎消息，介绍可用的链接管理命令。 