# 对联插件 (CoupletPlugin)

## 简介

对联插件是一个基于NcatBot框架的QQ机器人插件，可以根据用户输入的上联自动生成下联。插件支持普通对联生成和随机对联生成两种模式，并记录用户的对联历史。

## 功能特点

1. **对联生成**：根据用户输入的上联，生成对应的下联
2. **随机对联**：根据用户输入的上联，随机生成一个下联
3. **历史记录**：记录用户生成的对联历史
4. **敏感词过滤**：过滤生成结果中的敏感内容
5. **群聊和私聊支持**：同时支持群聊和私聊使用

## 使用方法

### 对联生成

输入上联，获取对应的下联：

```
对联 <上联>
```

示例：
```
对联 海上生明月
```

### 随机对联生成

输入上联，随机获取一个对应的下联：

```
对对联 <上联>
```

示例：
```
对对联 海上生明月
```

### 帮助命令

查看对联插件的帮助信息：

```
/couplet_help
```

## 技术实现

插件使用了[seq2seq-couplet-model](https://seq2seq-couplet-model.rssbrain.com/)的API来生成对联。API的响应格式为：

```json
{
  "output": ["下联1", "下联2", "下联3", ...]
}
```

插件会根据用户的请求选择合适的下联返回。

## 数据存储

插件将用户的对联历史记录存储在`data/couplet_history.json`文件中，格式如下：

```json
[
  {
    "user_id": "用户ID",
    "username": "用户名",
    "group_id": "群ID（私聊为null）",
    "shanglian": "上联",
    "xialian": "下联",
    "timestamp": 1647123456.789
  },
  ...
]
```

为了避免文件过大，插件只保留最近100条记录。

## 配置项

插件的配置项包括：

- `history_file`：历史记录文件路径
- `api_url`：对联生成API的URL
- `timeout`：API请求超时时间（秒）

## 依赖项

- httpx：用于发送HTTP请求
- asyncio：用于异步操作

## 注意事项

1. 插件依赖外部API，如果API不可用，将无法生成对联
2. 插件会过滤敏感内容，如果生成的所有下联都包含敏感内容，将返回提示信息
3. 插件记录的历史数据仅供参考，不会影响插件的正常使用 